
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nauha Lyrics — Offline</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <div class="logo">ن</div>
      <div>
        <div class="title">Nauha Lyrics</div>
        <div class="subtitle">Chat + Search • Offline-ready</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="small">Total: <span id="totalCount">0</span></div>
      <button id="btnClear" class="btn btn-outline">Clear</button>
    </div>
  </header>
  <div class="container">
    <div class="topbar">
      <div class="search" style="flex:1;display:flex;gap:8px;">
        <input id="searchInput" placeholder="Search by title, reciter, tags or phrase" />
        <button id="searchBtn">Search</button>
      </div>
    </div>

    <div class="chips" id="chipsContainer" aria-hidden="false" style="margin-bottom:12px"></div>

    <div class="main">
      <div class="content">
        <div id="results" class="results"></div>
      </div>
      <aside class="sidebar">
        <div class="panel">
          <h4>Reciters</h4>
          <div id="recitersList"></div>
        </div>
        <div class="panel">
          <h4>Tags</h4>
          <div id="tagsList"></div>
        </div>
      </aside>
    </div>
  </div>

  <div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;padding:18px">
    <div style="background:white;padding:18px;border-radius:12px;max-width:800px;width:100%;max-height:80vh;overflow:auto">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong id="modalTitle"></strong><div id="modalMeta" class="small"></div></div>
        <button id="closeModal" class="btn btn-outline">Close</button>
      </div>
      <pre id="modalLyrics" style="white-space:pre-wrap;"></pre>
    </div>
  </div>

<script>
let LYRICS = [];
async function load(){ try{ const r = await fetch('lyrics.json'); LYRICS = await r.json(); }catch(e){ LYRICS = []; console.warn('lyrics.json not found'); }
  LYRICS.forEach(it=>{ it._search = ((it.title||'')+' '+(it.reciter||'')+' '+(it.tags||[]).join(' ')+' '+(it.lyrics||'')).toLowerCase(); });
  document.getElementById('totalCount').textContent = LYRICS.length;
  buildLists(); renderResults(LYRICS.slice(0,60)); buildChips(['recent','popular','sajjad','sakina']); }

function buildLists(){
  const recMap = {}; const tagMap = {};
  LYRICS.forEach(it=>{ if(it.reciter){ recMap[it.reciter] = (recMap[it.reciter]||0)+1 } if(it.tags){ it.tags.forEach(t=> tagMap[t] = (tagMap[t]||0)+1) } });
  const reciters = Object.keys(recMap).sort((a,b)=> recMap[b]-recMap[a]).slice(0,60);
  const tags = Object.keys(tagMap).sort((a,b)=> tagMap[b]-tagMap[a]).slice(0,120);
  const rlist = document.getElementById('recitersList'); rlist.innerHTML=''; reciters.forEach(r=>{ const d = document.createElement('div'); d.className='list-item'; d.textContent = r + ' ('+recMap[r]+')'; d.onclick = ()=> filterByReciter(r); rlist.appendChild(d); });
  const tlist = document.getElementById('tagsList'); tlist.innerHTML=''; tags.forEach(t=>{ const d = document.createElement('div'); d.className='list-item'; d.textContent = t + ' ('+tagMap[t]+')'; d.onclick = ()=> filterByTag(t); tlist.appendChild(d); });
}

function buildChips(arr){ const c = document.getElementById('chipsContainer'); c.innerHTML=''; arr.forEach(ch=>{ const el = document.createElement('div'); el.className='chip'; el.textContent = ch; el.onclick = ()=> { document.getElementById('searchInput').value = ch; doSearch(); }; c.appendChild(el); }); }

function renderResults(items){
  const out = document.getElementById('results'); out.innerHTML='';
  if(!items || items.length===0){ out.innerHTML = '<div class="small">No results</div>'; return; }
  items.forEach(it=>{ const div = document.createElement('div'); div.className='card';
    const tags = (it.tags||[]).join(', ');
    div.innerHTML = '<h3>'+escapeHtml(it.title)+'</h3><div class="meta">'+escapeHtml(it.reciter||'')+' • '+escapeHtml(it.year||'')+'</div><p>'+escapeHtml((it.lyrics||'').slice(0,200))+'...</p>';
    const actions = document.createElement('div'); actions.className='card-actions';
    const view = document.createElement('button'); view.className='btn btn-outline'; view.textContent='View'; view.onclick = ()=> openModal(it);
    const fav = document.createElement('button'); fav.className='btn btn-accent'; fav.textContent='Save'; fav.onclick = ()=> toggleSave(it.id);
    actions.appendChild(view); actions.appendChild(fav); div.appendChild(actions);
    out.appendChild(div);
  }); 
}

function doSearch(){ const q = document.getElementById('searchInput').value.trim().toLowerCase(); if(!q){ renderResults(LYRICS.slice(0,60)); return; } const res = LYRICS.filter(it=> it._search.includes(q)); if(res.length===0){ const tokens = q.split(/\s+/).filter(Boolean); const rr = LYRICS.filter(it=> tokens.every(t=> it._search.includes(t))); renderResults(rr); } else renderResults(res); }

document.getElementById('searchBtn').addEventListener('click', doSearch);
document.getElementById('searchInput').addEventListener('keypress', e=>{ if(e.key==='Enter'){ e.preventDefault(); doSearch(); } });
document.getElementById('btnClear').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; renderResults(LYRICS.slice(0,60)); });

function filterByReciter(name){ const res = LYRICS.filter(it=> (it.reciter||'').toLowerCase()===name.toLowerCase()); renderResults(res); }
function filterByTag(tag){ const res = LYRICS.filter(it=> (it.tags||[]).map(x=>x.toLowerCase()).includes(tag.toLowerCase())); renderResults(res); }

function openModal(it){ document.getElementById('modal').style.display='flex'; document.getElementById('modalTitle').textContent = it.title; document.getElementById('modalMeta').textContent = (it.reciter||'') + ' • ' + (it.year||''); document.getElementById('modalLyrics').textContent = it.lyrics||''; }
document.getElementById('closeModal').addEventListener('click', ()=> document.getElementById('modal').style.display='none');

// saved functions

function loadSaved(){ return new Set(JSON.parse(localStorage.getItem('nl_saved')||'[]')); }
function saveSavedSet(s){ localStorage.setItem('nl_saved', JSON.stringify(Array.from(s))); renderSaved(); }
function toggleSave(id){ const s = loadSaved(); if(s.has(id)){ s.delete(id); alert('Removed from saved'); } else { s.add(id); alert('Saved'); } saveSavedSet(s); }
function renderSaved(){ const s = loadSaved(); const el = document.getElementById('recitersList'); /* reuse reciters list area for saved? */ const savedDiv = document.getElementById('tagsList'); savedDiv.innerHTML=''; if(s.size===0){ savedDiv.innerHTML='<div class="small">No saved items</div>'; return; } Array.from(s).forEach(id=>{ const it = LYRICS.find(x=> x.id==id); if(!it) return; const d = document.createElement('div'); d.className='list-item'; d.textContent = it.title; d.onclick = ()=> openModal(it); savedDiv.appendChild(d); }); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])); }

load();
</script>
</body>
</html>
