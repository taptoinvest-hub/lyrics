<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Ads Studio - Carousel Builder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables - Google Ads Theme */
        :root {
            --primary-color: #4285F4;
            --primary-light: #8AB4F8;
            --primary-dark: #1967D2;
            --secondary-color: #34A853;
            --accent-color: #EA4335;
            --warning-color: #FBBC05;
            
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --bg-tertiary: #E8F0FE;
            --bg-card: #FFFFFF;
            
            --text-primary: #202124;
            --text-secondary: #5F6368;
            --text-muted: #9AA0A6;
            --text-inverse: #FFFFFF;
            
            --border-color: #DADCE0;
            --border-light: #E8EAED;
            --border-dark: #BDC1C6;
            
            --shadow-sm: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --shadow-md: 0 1px 3px 0 rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
            --shadow-lg: 0 2px 6px 2px rgba(60,64,67,0.15), 0 1px 2px 0 rgba(60,64,67,0.3);
            
            --sidebar-width: 320px;
            --top-bar-height: 64px;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Mode */
        [data-mode="dark"] {
            --bg-primary: #202124;
            --bg-secondary: #303134;
            --bg-tertiary: #3C4043;
            --bg-card: #303134;
            
            --text-primary: #E8EAED;
            --text-secondary: #BDC1C6;
            --text-muted: #9AA0A6;
            
            --border-color: #5F6368;
            --border-light: #3C4043;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* Smooth Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
            transition: var(--transition);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* App Layout */
        .app-container {
            display: flex;
            height: 100vh;
            background: var(--bg-primary);
        }

        /* Left Panel */
        .left-panel {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Platform Header */
        .platform-header {
            padding: 20px 24px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
        }

        .platform-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .platform-info i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .platform-info h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .format-selector select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Section Styles */
        .section {
            border-bottom: 1px solid var(--border-color);
        }

        .section-header {
            padding: 16px 24px;
            background: var(--bg-card);
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header h3 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .section-content {
            padding: 20px 24px;
            background: var(--bg-card);
        }

        /* Gradient Grid */
        .gradient-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .gradient-btn {
            height: 60px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .gradient-btn:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }

        .gradient-btn.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        /* Text Controls */
        .text-controls .input-group {
            margin-bottom: 16px;
        }

        .text-controls label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .text-controls input, .text-controls textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .text-controls textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar */
        .top-bar {
            height: var(--top-bar-height);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
        }

        .top-bar-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .control-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .control-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Canvas Container */
        .canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-secondary);
            padding: 24px;
            position: relative;
        }

        .canvas-wrapper {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
        }

        #mainCanvas {
            display: block;
            background: white;
        }

        /* Canvas Elements */
        .canvas-element {
            position: absolute;
            cursor: move;
            user-select: none;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .canvas-element.selected {
            border-color: var(--primary-color);
        }

        .canvas-element textarea {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            resize: none;
            outline: none;
            font-family: inherit;
            padding: 8px;
        }

        .resize-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border: 2px solid white;
            border-radius: 50%;
        }

        .resize-nw { top: -4px; left: -4px; cursor: nw-resize; }
        .resize-ne { top: -4px; right: -4px; cursor: ne-resize; }
        .resize-sw { bottom: -4px; left: -4px; cursor: sw-resize; }
        .resize-se { bottom: -4px; right: -4px; cursor: se-resize; }

        /* Watermark */
        .watermark {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: rgba(0,0,0,0.3);
            font-size: 12px;
            font-weight: 600;
            pointer-events: none;
        }

        /* 30 Abstract Gradients */
        .gradient-ocean-blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-sunset-purple { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-tropical-green { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .gradient-forest { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .gradient-golden-hour { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .gradient-cotton-candy { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .gradient-peach { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .gradient-berry { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .gradient-sky { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        .gradient-lime { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
        .gradient-deep-space { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        .gradient-coral-reef { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        .gradient-midnight { background: linear-gradient(135deg, #0c0c6c 0%, #3a2c84 100%); }
        .gradient-desert { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .gradient-aurora { background: linear-gradient(135deg, #00c6fb 0%, #005bea 100%); }
        .gradient-sunset { background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%); }
        .gradient-ocean-depth { background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%); }
        .gradient-berry-smoothie { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .gradient-forest-mist { background: linear-gradient(135deg, #c2e59c 0%, #64b3f4 100%); }
        .gradient-royal { background: linear-gradient(135deg, #9d50bb 0%, #6e48aa 100%); }
        .gradient-citrus { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .gradient-deep-sea { background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%); }
        .gradient-warm-fire { background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); }
        .gradient-cool-mint { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .gradient-purple-rain { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-sunrise { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        .gradient-electric { background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%); }
        .gradient-twilight { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        .gradient-coral { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .gradient-galaxy { background: linear-gradient(135deg, #3a2c84 0%, #0c0c6c 100%); }
    </style>
</head>
<body data-platform="google-ads">
    <div class="app-container">
        <!-- Left Panel -->
        <div class="left-panel">
            <!-- Platform Header -->
            <div class="platform-header">
                <div class="platform-info">
                    <i class="fab fa-google"></i>
                    <h1>Google Ads Studio</h1>
                </div>
                <div class="format-selector">
                    <select id="formatSelect">
                        <option value="300x250">Inline Rectangle (300x250)</option>
                        <option value="336x280">Large Rectangle (336x280)</option>
                        <option value="728x90">Leaderboard (728x90)</option>
                        <option value="970x90">Large Leaderboard (970x90)</option>
                        <option value="300x600">Half Page (300x600)</option>
                        <option value="320x50">Mobile Banner (320x50)</option>
                        <option value="468x60">Banner (468x60)</option>
                        <option value="120x600">Skyscraper (120x600)</option>
                        <option value="160x600">Wide Skyscraper (160x600)</option>
                        <option value="970x250">Billboard (970x250)</option>
                    </select>
                </div>
            </div>

            <!-- Background Section -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-fill-drip"></i>
                    <h3>Background</h3>
                </div>
                <div class="section-content">
                    <div class="gradient-grid" id="gradientGrid">
                        <!-- Gradients will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Text Content Section -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-font"></i>
                    <h3>Text Content</h3>
                </div>
                <div class="section-content">
                    <div class="text-controls">
                        <div class="input-group">
                            <label for="headlineText">Headline</label>
                            <input type="text" id="headlineText" placeholder="Enter headline">
                        </div>
                        <div class="input-group">
                            <label for="descriptionText">Description</label>
                            <textarea id="descriptionText" placeholder="Enter description"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ctaText">Call to Action</label>
                            <input type="text" id="ctaText" placeholder="Enter CTA">
                        </div>
                        <button class="btn btn-primary" id="addTextBtn">
                            <i class="fas fa-plus"></i> Add Text Element
                        </button>
                    </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-download"></i>
                    <h3>Export</h3>
                </div>
                <div class="section-content">
                    <button class="btn btn-primary" id="exportBtn">
                        <i class="fas fa-file-export"></i> Export as PNG
                    </button>
                    <div style="margin-top: 12px; display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="watermarkToggle" checked>
                        <label for="watermarkToggle">Show MarkTika Watermark</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-controls">
                    <button class="control-btn" id="zoomOutBtn" title="Zoom Out">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="control-btn" id="fitScreenBtn" title="Fit to Screen">
                        <i class="fas fa-expand-alt"></i>
                    </button>
                    <button class="control-btn" id="zoomInBtn" title="Zoom In">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <span id="zoomLevel">100%</span>
                </div>
                <div class="top-bar-controls">
                    <button class="control-btn" id="undoBtn" title="Undo">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="control-btn" id="redoBtn" title="Redo">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="control-btn" id="clearBtn" title="Clear All">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <!-- Canvas Container -->
            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <canvas id="mainCanvas"></canvas>
                    <div class="watermark" id="watermark">MarkTika</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GoogleAdsStudio {
            constructor() {
                this.canvas = document.getElementById('mainCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.currentFormat = '300x250';
                this.zoomLevel = 1;
                this.elements = [];
                this.selectedElement = null;
                this.isDragging = false;
                this.isResizing = false;
                this.dragOffset = { x: 0, y: 0 };
                this.history = [];
                this.historyIndex = -1;
                
                this.formats = {
                    '300x250': { width: 300, height: 250 },
                    '336x280': { width: 336, height: 280 },
                    '728x90': { width: 728, height: 90 },
                    '970x90': { width: 970, height: 90 },
                    '300x600': { width: 300, height: 600 },
                    '320x50': { width: 320, height: 50 },
                    '468x60': { width: 468, height: 60 },
                    '120x600': { width: 120, height: 600 },
                    '160x600': { width: 160, height: 600 },
                    '970x250': { width: 970, height: 250 }
                };

                this.gradients = [
                    'gradient-ocean-blue', 'gradient-sunset-purple', 'gradient-tropical-green',
                    'gradient-forest', 'gradient-golden-hour', 'gradient-cotton-candy',
                    'gradient-peach', 'gradient-berry', 'gradient-sky', 'gradient-lime',
                    'gradient-deep-space', 'gradient-coral-reef', 'gradient-midnight',
                    'gradient-desert', 'gradient-aurora', 'gradient-sunset',
                    'gradient-ocean-depth', 'gradient-berry-smoothie', 'gradient-forest-mist',
                    'gradient-royal', 'gradient-citrus', 'gradient-deep-sea',
                    'gradient-warm-fire', 'gradient-cool-mint', 'gradient-purple-rain',
                    'gradient-sunrise', 'gradient-electric', 'gradient-twilight',
                    'gradient-coral', 'gradient-galaxy'
                ];

                this.currentBackground = 'gradient-ocean-blue';
                this.showWatermark = true;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.populateGradients();
                this.updateCanvasSize();
                this.render();
                this.saveState();
            }

            setupEventListeners() {
                // Format selection
                document.getElementById('formatSelect').addEventListener('change', (e) => {
                    this.currentFormat = e.target.value;
                    this.updateCanvasSize();
                    this.render();
                });

                // Gradient selection
                document.getElementById('gradientGrid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('gradient-btn')) {
                        document.querySelectorAll('.gradient-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        e.target.classList.add('active');
                        this.currentBackground = e.target.dataset.gradient;
                        this.render();
                    }
                });

                // Add text element
                document.getElementById('addTextBtn').addEventListener('click', () => {
                    this.addTextElement();
                });

                // Export
                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportAsPNG();
                });

                // Watermark toggle
                document.getElementById('watermarkToggle').addEventListener('change', (e) => {
                    this.showWatermark = e.target.checked;
                    document.getElementById('watermark').style.display = this.showWatermark ? 'block' : 'none';
                });

                // Zoom controls
                document.getElementById('zoomInBtn').addEventListener('click', () => {
                    this.zoomLevel = Math.min(this.zoomLevel + 0.25, 3);
                    this.updateZoom();
                });

                document.getElementById('zoomOutBtn').addEventListener('click', () => {
                    this.zoomLevel = Math.max(this.zoomLevel - 0.25, 0.25);
                    this.updateZoom();
                });

                document.getElementById('fitScreenBtn').addEventListener('click', () => {
                    this.fitToScreen();
                });

                // History controls
                document.getElementById('undoBtn').addEventListener('click', () => this.undo());
                document.getElementById('redoBtn').addEventListener('click', () => this.redo());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearAll());

                // Canvas interaction
                this.canvas.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.canvas.addEventListener('mouseup', () => this.handleMouseUp());
                this.canvas.addEventListener('dblclick', (e) => this.handleDoubleClick(e));

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'z':
                                e.preventDefault();
                                this.undo();
                                break;
                            case 'y':
                                e.preventDefault();
                                this.redo();
                                break;
                            case 'a':
                                e.preventDefault();
                                this.addTextElement();
                                break;
                        }
                    }
                    if (e.key === 'Delete' && this.selectedElement) {
                        this.removeElement(this.selectedElement);
                    }
                });
            }

            populateGradients() {
                const grid = document.getElementById('gradientGrid');
                this.gradients.forEach((gradient, index) => {
                    const btn = document.createElement('button');
                    btn.className = `gradient-btn ${gradient} ${index === 0 ? 'active' : ''}`;
                    btn.dataset.gradient = gradient;
                    grid.appendChild(btn);
                });
            }

            updateCanvasSize() {
                const format = this.formats[this.currentFormat];
                this.canvas.width = format.width;
                this.canvas.height = format.height;
                this.updateZoom();
            }

            updateZoom() {
                const format = this.formats[this.currentFormat];
                this.canvas.style.width = `${format.width * this.zoomLevel}px`;
                this.canvas.style.height = `${format.height * this.zoomLevel}px`;
                document.getElementById('zoomLevel').textContent = `${Math.round(this.zoomLevel * 100)}%`;
            }

            fitToScreen() {
                const container = document.querySelector('.canvas-container');
                const format = this.formats[this.currentFormat];
                
                const containerWidth = container.clientWidth - 48;
                const containerHeight = container.clientHeight - 48;
                
                const scaleX = containerWidth / format.width;
                const scaleY = containerHeight / format.height;
                
                this.zoomLevel = Math.min(scaleX, scaleY, 1);
                this.updateZoom();
            }

            addTextElement() {
                const headline = document.getElementById('headlineText').value || 'Headline';
                const description = document.getElementById('descriptionText').value || 'Description';
                const cta = document.getElementById('ctaText').value || 'Learn More';
                
                const textElement = {
                    id: Date.now(),
                    type: 'text',
                    x: 20,
                    y: 20,
                    width: this.canvas.width - 40,
                    height: 100,
                    content: `${headline}\n${description}\n${cta}`,
                    fontSize: 16,
                    color: '#000000'
                };
                
                this.elements.push(textElement);
                this.selectedElement = textElement;
                this.saveState();
                this.render();
                
                // Clear input fields
                document.getElementById('headlineText').value = '';
                document.getElementById('descriptionText').value = '';
                document.getElementById('ctaText').value = '';
            }

            render() {
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw background
                this.drawBackground();
                
                // Draw elements
                this.elements.forEach(element => {
                    this.drawElement(element);
                });
                
                // Draw selection outline
                if (this.selectedElement) {
                    this.drawSelection(this.selectedElement);
                }
            }

            drawBackground() {
                // For demo, we'll use a solid color based on gradient class
                // In a real implementation, you'd parse the actual gradient
                const gradientColors = {
                    'gradient-ocean-blue': ['#667eea', '#764ba2'],
                    'gradient-sunset-purple': ['#f093fb', '#f5576c'],
                    'gradient-tropical-green': ['#4facfe', '#00f2fe'],
                    // Add more gradient mappings as needed
                };
                
                const colors = gradientColors[this.currentBackground] || ['#667eea', '#764ba2'];
                const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
                gradient.addColorStop(0, colors[0]);
                gradient.addColorStop(1, colors[1]);
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            }

            drawElement(element) {
                if (element.type === 'text') {
                    this.ctx.fillStyle = element.color;
                    this.ctx.font = `${element.fontSize}px Inter`;
                    this.ctx.textBaseline = 'top';
                    
                    const lines = element.content.split('\n');
                    lines.forEach((line, index) => {
                        this.ctx.fillText(line, element.x, element.y + (index * (element.fontSize + 4)));
                    });
                }
            }

            drawSelection(element) {
                this.ctx.strokeStyle = '#4285F4';
                this.ctx.lineWidth = 2;
                this.ctx.setLineDash([5, 5]);
                this.ctx.strokeRect(element.x - 2, element.y - 2, element.width + 4, element.height + 4);
                this.ctx.setLineDash([]);
            }

            handleMouseDown(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scale = this.canvas.width / rect.width;
                const x = (e.clientX - rect.left) * scale;
                const y = (e.clientY - rect.top) * scale;
                
                // Check if clicking on an element
                this.selectedElement = null;
                for (let i = this.elements.length - 1; i >= 0; i--) {
                    const element = this.elements[i];
                    if (x >= element.x && x <= element.x + element.width &&
                        y >= element.y && y <= element.y + element.height) {
                        this.selectedElement = element;
                        this.isDragging = true;
                        this.dragOffset.x = x - element.x;
                        this.dragOffset.y = y - element.y;
                        break;
                    }
                }
                
                this.render();
            }

            handleMouseMove(e) {
                if (this.isDragging && this.selectedElement) {
                    const rect = this.canvas.getBoundingClientRect();
                    const scale = this.canvas.width / rect.width;
                    const x = (e.clientX - rect.left) * scale - this.dragOffset.x;
                    const y = (e.clientY - rect.top) * scale - this.dragOffset.y;
                    
                    // Keep element within canvas bounds
                    this.selectedElement.x = Math.max(0, Math.min(x, this.canvas.width - this.selectedElement.width));
                    this.selectedElement.y = Math.max(0, Math.min(y, this.canvas.height - this.selectedElement.height));
                    
                    this.render();
                }
            }

            handleMouseUp() {
                if (this.isDragging) {
                    this.isDragging = false;
                    this.saveState();
                }
            }

            handleDoubleClick(e) {
                if (this.selectedElement && this.selectedElement.type === 'text') {
                    // In a real implementation, you'd show a text editor
                    const newText = prompt('Edit text:', this.selectedElement.content);
                    if (newText !== null) {
                        this.selectedElement.content = newText;
                        this.saveState();
                        this.render();
                    }
                }
            }

            removeElement(element) {
                this.elements = this.elements.filter(el => el.id !== element.id);
                this.selectedElement = null;
                this.saveState();
                this.render();
            }

            clearAll() {
                if (confirm('Are you sure you want to clear all elements?')) {
                    this.elements = [];
                    this.selectedElement = null;
                    this.saveState();
                    this.render();
                }
            }

            saveState() {
                const state = {
                    elements: JSON.parse(JSON.stringify(this.elements)),
                    background: this.currentBackground,
                    format: this.currentFormat
                };

                if (JSON.stringify(state) !== JSON.stringify(this.history[this.historyIndex])) {
                    if (this.historyIndex < this.history.length - 1) {
                        this.history = this.history.slice(0, this.historyIndex + 1);
                    }
                    
                    this.history.push(state);
                    this.historyIndex++;
                    
                    // Keep only last 50 states
                    if (this.history.length > 50) {
                        this.history.shift();
                        this.historyIndex--;
                    }
                }
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.loadState();
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.loadState();
                }
            }

            loadState() {
                const state = this.history[this.historyIndex];
                this.elements = state.elements;
                this.currentBackground = state.background;
                this.currentFormat = state.format;
                
                document.getElementById('formatSelect').value = this.currentFormat;
                document.querySelectorAll('.gradient-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.gradient === this.currentBackground);
                });
                
                this.updateCanvasSize();
                this.render();
            }

            exportAsPNG() {
                // Create a temporary canvas for export
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                const format = this.formats[this.currentFormat];
                
                tempCanvas.width = format.width;
                tempCanvas.height = format.height;
                
                // Draw background
                this.drawBackgroundOnCanvas(tempCtx, format.width, format.height);
                
                // Draw elements
                this.elements.forEach(element => {
                    this.drawElementOnCanvas(tempCtx, element);
                });
                
                // Draw watermark if enabled
                if (this.showWatermark) {
                    tempCtx.fillStyle = 'rgba(0,0,0,0.3)';
                    tempCtx.font = '12px Inter';
                    tempCtx.fillText('MarkTika', 10, format.height - 10);
                }
                
                // Download
                tempCanvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `google-ad-${this.currentFormat}-${Date.now()}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    alert('âœ… Ad exported successfully!');
                });
            }

            drawBackgroundOnCanvas(ctx, width, height) {
                // Simplified background for export
                ctx.fillStyle = '#667eea';
                ctx.fillRect(0, 0, width, height);
            }

            drawElementOnCanvas(ctx, element) {
                if (element.type === 'text') {
                    ctx.fillStyle = element.color;
                    ctx.font = `${element.fontSize}px Inter`;
                    ctx.textBaseline = 'top';
                    
                    const lines = element.content.split('\n');
                    lines.forEach((line, index) => {
                        ctx.fillText(line, element.x, element.y + (index * (element.fontSize + 4)));
                    });
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new GoogleAdsStudio();
        });
    </script>
</body>
</html>
